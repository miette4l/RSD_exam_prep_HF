Portions of the code were written by Dáithí, Merlin's helper.